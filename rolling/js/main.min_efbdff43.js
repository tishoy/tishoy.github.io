var __reflect=this&&this.__reflect||function(t,e,n){t.__class__=e,n?n.push(e):n=[e],t.__types__=t.__types__?n.concat(t.__types__):n},__extends=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);n.prototype=e.prototype,t.prototype=new n},__awaiter=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))(function(o,r){function s(t){try{c(i.next(t))}catch(e){r(e)}}function a(t){try{c(i["throw"](t))}catch(e){r(e)}}function c(t){t.done?o(t.value):new n(function(e){e(t.value)}).then(s,a)}c((i=i.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function n(t){return function(e){return i([t,e])}}function i(n){if(o)throw new TypeError("Generator is already executing.");for(;c;)try{if(o=1,r&&(s=r[2&n[0]?"return":n[0]?"throw":"next"])&&!(s=s.call(r,n[1])).done)return s;switch(r=0,s&&(n=[0,s.value]),n[0]){case 0:case 1:s=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,r=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(s=c.trys,!(s=s.length>0&&s[s.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3])){c.label=n[1];break}if(6===n[0]&&c.label<s[1]){c.label=s[1],s=n;break}if(s&&c.label<s[2]){c.label=s[2],c.ops.push(n);break}s[2]&&c.ops.pop(),c.trys.pop();continue}n=e.call(t,c)}catch(i){n=[6,i],r=0}finally{o=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var o,r,s,a,c={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:n(0),"throw":n(1),"return":n(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a},Item=function(t){function e(e){var n=t.call(this)||this;n._id=0;var i=new egret.TextField;return i.text=e,n._text=e,i.x=0,n.addChild(i),n.closeBtn=new egret.Bitmap,n.closeBtn.texture=RES.getRes("cancel_png"),n.closeBtn.x=520,n.closeBtn.touchEnabled=!0,n.addChild(n.closeBtn),n}return __extends(e,t),Object.defineProperty(e.prototype,"text",{get:function(){return this._text},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"id",{set:function(t){this.closeBtn.name=t.toString()},enumerable:!0,configurable:!0}),e}(egret.Sprite);__reflect(Item.prototype,"Item");var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},e.prototype.onProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var Main=function(t){function e(){var e=t.call(this)||this;return e.choosesObj={},e.chooseList=[],e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(t){egret.lifecycle.addLifecycleListener(function(t){t.onUpdate=function(){}}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()},this.runGame()["catch"](function(t){console.log(t)})},e.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(n){switch(n.label){case 0:return[4,this.loadResource()];case 1:return n.sent(),this.createGameScene(),[4,RES.getResAsync("description_json")];case 2:return t=n.sent(),[4,platform.login()];case 3:return n.sent(),[4,platform.getUserInfo()];case 4:return e=n.sent(),console.log(e),[2]}})})},e.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(n){switch(n.label){case 0:return n.trys.push([0,3,,4]),t=new LoadingUI,this.stage.addChild(t),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return n.sent(),[4,RES.loadGroup("preload",0,t)];case 2:return n.sent(),this.stage.removeChild(t),[3,4];case 3:return e=n.sent(),console.error(e),[3,4];case 4:return[2]}})})},e.prototype.initDefault=function(){var t,e=egret.localStorage.getItem("default");null!==e&&void 0!==e&&""!==e?this.choosesObj=JSON.parse(e):this.choosesObj={0:"牛肉面",1:"米粉",2:"呷哺",3:"味千",4:"全时",5:"绿茶",6:"烤鱼",7:"生煎"};for(var n in this.choosesObj)t=new Item(this.choosesObj[n]),t.closeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.chooseList.push(t);this.updateView()},e.prototype.onClose=function(t){console.log(t.target);var e=t.target;this.chooseList.splice(Number(t.target.name),1),e.parent.parent.removeChild(e.parent),this.updateView(),this.saveData()},e.prototype.updateView=function(){console.log(this.chooseList);for(var t=0;t<this.chooseList.length;t++)this.chooseList[t].id=t,this.chooseList[t].x=60,this.chooseList[t].y=120+50*t,this.contains(this.chooseList[t])||this.addChild(this.chooseList[t])},e.prototype.createGameScene=function(){this.initDefault(),this.inputTextfield=new egret.TextField,this.inputTextfield.type=egret.TextFieldType.INPUT,this.inputTextfield.text="在此输入新的选择",this.inputTextfield.x=50,this.inputTextfield.y=50,this.inputTextfield.width=300,this.inputTextfield.addEventListener(egret.FocusEvent.FOCUS_IN,this.onInputClick,this),this.inputTextfield.addEventListener(egret.FocusEvent.FOCUS_OUT,this.onInputOut,this),this.addChild(this.inputTextfield),this.acceptBtn=new egret.Bitmap,this.acceptBtn.texture=RES.getRes("accept_png"),this.acceptBtn.x=350,this.acceptBtn.y=50,this.acceptBtn.touchEnabled=!0,this.acceptBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onAccept,this),this.addChild(this.acceptBtn),this.goBtn=new egret.Bitmap,this.goBtn.texture=RES.getRes("go_png"),this.goBtn.x=450,this.goBtn.y=50,this.goBtn.touchEnabled=!0,this.goBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRandom,this),this.addChild(this.goBtn)},e.prototype.onRandom=function(t){var e=Math.floor(Math.random()*this.chooseList.length);console.log(e),this.inputTextfield.text=this.chooseList[e].text},e.prototype.onAccept=function(t){var e=new Item(this.inputTextfield.text);e.closeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.chooseList.push(e),this.updateView(),this.saveData()},e.prototype.saveData=function(){for(var t={},e=0;e<this.chooseList.length;e++)t[e]=this.chooseList[e].text;var n=JSON.stringify(t);egret.localStorage.setItem("default",n)},e.prototype.onInputOut=function(t){""===this.inputTextfield.text&&(this.inputTextfield.text="在此输入新的选择")},e.prototype.onInputClick=function(t){this.inputTextfield.text=""},e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,n=RES.getRes(t);return e.texture=n,e},e}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");var DebugPlatform=function(){function t(){}return t.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,{nickName:"username"}]})})},t.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);